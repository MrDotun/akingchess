<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play vs Aking Master | AKINGCHESS</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --green: #064e3b; --gold: #fbbf24; --dark: #022c22; }
        body { background: var(--green); color: white; font-family: 'Poppins', sans-serif; text-align: center; margin: 0; }
        nav { background: var(--dark); border-bottom: 5px solid var(--gold); padding: 15px 0; }
        nav a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; text-transform: uppercase; font-size: 0.8rem; }
        .game-container { max-width: 500px; margin: 20px auto; padding: 10px; }
        #myBoard { width: 100%; border: 5px solid var(--gold); border-radius: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .highlight-square { box-shadow: inset 0 0 3px 3px rgba(251, 191, 36, 0.8); }
        .chat-box { background: var(--dark); border: 2px solid var(--gold); margin-top: 20px; padding: 15px; border-radius: 8px; min-height: 80px; }
        #master-talk { font-style: italic; color: var(--gold); font-size: 1.1rem; line-height: 1.4; }
        .controls { margin: 20px 0; display: flex; justify-content: center; gap: 10px; }
        button, select { background: var(--gold); border: none; padding: 12px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; font-family: 'Poppins'; }
    </style>
</head>
<body>

<nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="lichess.html">Lichess</a>
</nav>

<div class="game-container">
    <h2 style="font-family: 'Cinzel'; color: var(--gold); letter-spacing: 2px;">AKING MASTER AI</h2>
    
    <div class="controls">
        <select id="timeControl">
            <option value="3">3 Mins</option>
            <option value="10" selected>10 Mins</option>
            <option value="20">20 Mins</option>
        </select>
        <button onclick="startGame()">Start Challenge</button>
    </div>

    <div id="myBoard"></div>
    
    <div class="chat-box">
        <p id="master-talk">"Scholar's Mate? Not on my watch, " + playerName + "!"</p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

<script>
    var board = null;
    var game = new Chess();
    var playerName = "";
    var $chat = $('#master-talk');
    var selectedSquare = null;

    var pieceValues = { p: 1, n: 3, b: 3, r: 5, q: 9, k: 900 };

    function removeHighlights() {
        $('#myBoard .square-55d63').removeClass('highlight-square');
    }

    function onSquareClick(square) {
        if (game.game_over()) return;
        if (selectedSquare === null) {
            var piece = game.get(square);
            if (piece && piece.color === 'w') {
                selectedSquare = square;
                removeHighlights();
                $('#myBoard .square-' + square).addClass('highlight-square');
            }
            return;
        }

        var move = game.move({ from: selectedSquare, to: square, promotion: 'q' });

        if (move === null) {
            var piece = game.get(square);
            if (piece && piece.color === 'w') {
                selectedSquare = square;
                removeHighlights();
                $('#myBoard .square-' + square).addClass('highlight-square');
            } else {
                selectedSquare = null;
                removeHighlights();
            }
        } else {
            selectedSquare = null;
            removeHighlights();
            board.position(game.fen());
            window.setTimeout(makeAkingMove, 500);
        }
    }

    function evaluateMove(move) {
        var score = 0;
        
        // 1. Defend King (Massive bonus for preventing mate/checks)
        game.move(move);
        if (game.in_check()) score -= 50; // Don't walk into check
        
        // 2. Scholar's Mate Defense: Specifically watch the f7 square
        if (move.to === 'f7' || move.to === 'f2') score += 10;
        
        // Check if the opponent can mate in the next move
        var oppMoves = game.moves();
        for(var i=0; i<oppMoves.length; i++) {
            if (oppMoves[i].includes('#')) score -= 100; // RUN! This move leads to mate
        }
        game.undo();

        // Standard logic
        if (move.captured) score += (pieceValues[move.captured] * 15);
        if (move.piece === 'q') score += 5;
        if (move.piece === 'r') score += 4;
        if (move.san === 'O-O' || move.san === 'O-O-O') score += 25;
        
        return score;
    }

    function makeAkingMove () {
        var possibleMoves = game.moves({ verbose: true });
        if (possibleMoves.length === 0) return handleGameOver();

        // Smart selection to avoid Scholars Mate
        possibleMoves.sort((a, b) => evaluateMove(b) - evaluateMove(a));
        
        var move = possibleMoves[0];
        game.move(move);
        board.position(game.fen());
        masterComments(move);
        if (game.game_over()) handleGameOver();
    }

    function masterComments(move) {
        var lines = [
            "Nice try with that Queen, but I'm protecting my King!",
            "You can't fool me with basic traps, " + playerName + ".",
            "Development and safetyâ€”that's how a Master plays.",
            "Scholar's Mate? That's for beginners. Try something else!",
            "My pieces are standing guard. No easy wins here!"
        ];
        
        if (game.in_check()) {
            $chat.text("CHECK! Not today, " + playerName + "!");
        } else if (Math.random() > 0.6) {
            $chat.text(lines[Math.floor(Math.random() * lines.length)]);
        }
    }

    function handleGameOver() {
        var result = game.in_checkmate() ? (game.turn() === 'b' ? "YOU WON!" : "I WON!") : "DRAW!";
        var title = (result === "YOU WON!") ? "GRANDMASTER SLAYER" : "AKING APPRENTICE";
        alert("GAME OVER: " + result + "\nTitle Awarded: " + title);
    }

    function startGame() {
        playerName = prompt("Your name, future Grandmaster?");
        if (!playerName) playerName = "Player One";
        game.reset();
        board.start();
        $chat.text("Ready " + playerName + "? Let's see your real strategy!");
    }

    board = Chessboard('myBoard', {
        position: 'start',
        draggable: false,
        pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    $('#myBoard').on('click', '.square-55d63', function () {
        var square = $(this).attr('data-square');
        onSquareClick(square);
    });
</script>

</body>
</html>
