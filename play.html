<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKING Chess Master - Royal Arena</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { background: #1a1a1a; color: #d4af37; font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        #setup-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .setup-box { background: #2c3e50; padding: 30px; border: 3px solid #d4af37; border-radius: 15px; text-align: center; }
        #board { width: 450px; border: 8px solid #333; border-radius: 5px; }
        .game-container { display: flex; gap: 20px; align-items: flex-start; margin-top: 20px; }
        .side-panel { width: 250px; background: #222; padding: 15px; border-radius: 10px; border: 1px solid #444; }
        .clock { font-family: monospace; font-size: 2em; background: #000; color: #ff3e3e; padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center; border: 2px solid #333; }
        .active-clock { border-color: #d4af37; color: #00ff00; }
        .chat-box { height: 100px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; font-style: italic; color: #fff; margin: 10px 0; border: 1px solid #d4af37; }
        button { background: #d4af37; color: #000; border: none; padding: 10px 15px; font-weight: bold; border-radius: 5px; cursor: pointer; margin: 5px; transition: 0.2s; }
        button:hover { background: #fff; }
        .btn-danger { background: #e74c3c; color: white; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <div class="setup-box">
            <h1>ðŸ‘‘ Enter the Arena</h1>
            <p>Choose your side:</p>
            <button onclick="startGame('w')">White (Go First)</button>
            <button onclick="startGame('b')">Black (Go Second)</button>
            <p>Time Control:</p>
            <select id="time-select" style="padding: 10px;">
                <option value="5">5 Minutes (Blitz)</option>
                <option value="10" selected>10 Minutes (Rapid)</option>
                <option value="30">30 Minutes (Classical)</option>
            </select>
        </div>
    </div>

    <h1>ðŸ‘‘ AKING Chess Master</h1>

    <div class="game-container">
        <div id="board"></div>
        
        <div class="side-panel">
            <div id="name-king">AKING</div>
            <div id="clock-b" class="clock">10:00</div>
            
            <div class="chat-box" id="chat">"Prepare to face the King!"</div>
            
            <div id="clock-w" class="clock">10:00</div>
            <div id="name-player">You</div>
            
            <hr border="1" color="#444">
            <div style="display: flex; flex-wrap: wrap;">
                <button class="btn-danger" onclick="resign()">Resign</button>
                <button onclick="offerDraw()">Offer Draw</button>
            </div>
            <div id="status" style="margin-top:10px; font-weight: bold;"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();
        var aking = new Worker('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js');
        var playerColor = 'w';
        var timer = null;
        var timeLeft = { w: 600, b: 600 };
        
        const remarks = [
            "Interesting... but my Grandma castles faster than that!",
            "Is that a move or a mistake? I can't tell.",
            "I'm protecting my Queen like she's made of gold!",
            "You'll have to do better to get past my Royal Guard.",
            "A bold move! Unfortunately, I am bolder.",
            "I've seen pawns with more courage than that.",
            "Nice try, but my King is currently sipping tea in safety.",
            "Are you trying to win, or just moving pieces for exercise?",
            "My Rooks are hungry today. Be careful!",
            "That move felt a bit... suspicious.",
            "I've calculated 4 million ways to beat you. That wasn't one of them.",
            "Oh, you're approaching me? Instead of running away?",
            "I'll give you a hint: Check your back rank!",
            "My pieces work together like a fine-tuned orchestra.",
            "You move like a Knight with a broken leg.",
            "Wait, was that your plan? Really?",
            "I'm not just a computer, I'm a Chess Legend.",
            "Careful! Your Queen looks a bit lonely over there.",
            "I castle early because I value my Royal hair.",
            "Check! (Or it will be soon, trust me)."
        ];

        aking.postMessage('uci');
        aking.postMessage('setoption name Skill Level value 20');
        aking.postMessage('setoption name Hash value 512');

        function startGame(color) {
            playerColor = color;
            let mins = document.getElementById('time-select').value;
            timeLeft.w = mins * 60;
            timeLeft.b = mins * 60;
            updateClocks();
            document.getElementById('setup-screen').style.display = 'none';
            
            board = ChessBoard('board', {
                draggable: true,
                position: 'start',
                orientation: color === 'w' ? 'white' : 'black',
                onDragStart: onDragStart,
                onDrop: onDrop,
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
            });

            startTimer();
            if (playerColor === 'b') window.setTimeout(makeAKINGMove, 500);
        }

        function startTimer() {
            if (timer) clearInterval(timer);
            timer = setInterval(() => {
                let turn = game.turn();
                timeLeft[turn]--;
                updateClocks();
                if (timeLeft[turn] <= 0) endGame("Time out!");
            }, 1000);
        }

        function updateClocks() {
            const format = (s) => Math.floor(s/60) + ":" + (s%60).toString().padStart(2,'0');
            document.getElementById('clock-w').innerHTML = format(timeLeft.w);
            document.getElementById('clock-b').innerHTML = format(timeLeft.b);
            document.getElementById('clock-w').className = game.turn() === 'w' ? 'clock active-clock' : 'clock';
            document.getElementById('clock-b').className = game.turn() === 'b' ? 'clock active-clock' : 'clock';
        }

        function onDragStart(s, piece) {
            if (game.game_over() || (playerColor === 'w' && piece.search(/^b/) !== -1) || (playerColor === 'b' && piece.search(/^w/) !== -1)) return false;
        }

        function onDrop(source, target) {
            var move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';
            
            addRemark();
            window.setTimeout(makeAKINGMove, 100);
        }

        function makeAKINGMove() {
            if (game.game_over()) { updateStatus(); return; }
            aking.postMessage('position fen ' + game.fen());
            aking.postMessage('go depth 20');
            aking.onmessage = function(e) {
                if (e.data.includes('bestmove')) {
                    let moveStr = e.data.split(' ')[1];
                    game.move({ from: moveStr.substring(0,2), to: moveStr.substring(2,4), promotion: 'q' });
                    board.position(game.fen());
                    updateStatus();
                }
            };
        }

        function addRemark() {
            let r = remarks[Math.floor(Math.random() * remarks.length)];
            document.getElementById('chat').innerHTML = `<strong>AKING:</strong> "${r}"`;
        }

        function offerDraw() {
            document.getElementById('chat').innerHTML = `<strong>AKING:</strong> "A draw? A King never settles for half a victory! DECLINED!"`;
        }

        function resign() {
            endGame("You resigned.");
        }

        function updateStatus() {
            if (game.in_checkmate()) endGame("Checkmate!");
            else if (game.in_draw()) endGame("Draw.");
        }

        function endGame(reason) {
            clearInterval(timer);
            let result = game.turn() === (playerColor === 'w' ? 'b' : 'w') ? "AKING WINS" : "YOU WIN";
            if (reason.includes("resigned")) result = "AKING WINS";
            
            // TITLES
            let titles = ["Grandmaster of the Cookie Jar", "The Chess Wizard", "Duke of Diagonals", "Slayer of Knights", "The Patient Pawn"];
            let title = titles[Math.floor(Math.random() * titles.length)];
            
            alert(`${result}!\nReason: ${reason}\n\nBy Royal Decree, you are awarded the title:\nðŸ‘‘ ${title} ðŸ‘‘`);
            location.reload();
        }
    </script>
</body>
</html>
